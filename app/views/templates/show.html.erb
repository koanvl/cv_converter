<div class="min-h-screen bg-gray-50">
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center space-x-4">
          <%= link_to templates_path, 
              class: "inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900" do %>
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
          <% end %>
          
          <div class="border-l border-gray-300 pl-4">
            <h1 class="text-xl font-semibold text-gray-900">
              üìÑ <%= @template.title %>
            </h1>
            <p class="text-sm text-gray-500">
              –°–æ–∑–¥–∞–Ω: <%= @template.created_at.strftime("%d.%m.%Y –≤ %H:%M") %>
            </p>
          </div>
        </div>
        
        <div class="flex space-x-3">
          <%= link_to edit_template_path(@template),
              class: "inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" do %>
            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          <% end %>
          
          <%= link_to template_path(@template),
              method: :delete,
              confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω '#{@template.title}'?",
              class: "inline-flex items-center px-4 py-2 text-sm font-medium text-red-700 bg-red-100 border border-transparent rounded-md hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" do %>
            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —à–∞–±–ª–æ–Ω–∞ -->
  <div class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="border-b border-gray-200 bg-gray-50 px-6 py-3">
          <h3 class="text-sm font-medium text-gray-900">
            –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞
          </h3>
        </div>
        
        <div class="p-6">
          <% 
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
            html_content = ""
            css_content = ""
            
            # –°–ø–æ—Å–æ–± 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è html/css
            if @template.html.present?
              html_content = @template.html
              css_content = @template.css || ""
            # –°–ø–æ—Å–æ–± 2: –ü–∞—Ä—Å–∏–º JSON –¥–∞–Ω–Ω—ã–µ
            elsif @template.data.present?
              begin
                template_data = JSON.parse(@template.data)
                
                # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                if template_data['gjs_html']
                  html_content = template_data['gjs_html']
                  css_content = template_data['gjs_css'] || ""
                # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π GrapesJS —Ñ–æ—Ä–º–∞—Ç
                elsif template_data['pages'] && template_data['pages'].any?
                  template_data['pages'].each do |page|
                    if page['frames'] && page['frames'].any?
                      frame = page['frames'][0]
                      if frame['component']
                        html_content = frame['component']
                      end
                    end
                  end
                  if template_data['assets']
                    css_content = template_data['assets']
                  end
                # –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç
                elsif template_data['html']
                  html_content = template_data['html']
                  css_content = template_data['css'] || ""
                end
              rescue JSON::ParserError
                # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
              end
            end
          %>
          
          <% if html_content.present? %>
            <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º CSS -->
            <% if css_content.present? %>
              <style>
                <%= raw css_content %>
              </style>
            <% end %>
            
            <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º HTML –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div id="template-content" class="min-h-[400px]">
              <%= raw html_content %>
            </div>
          <% else %>
            <!-- –ü—É—Å—Ç–æ–π —à–∞–±–ª–æ–Ω -->
            <div class="text-center py-12">
              <div class="text-gray-400 text-4xl mb-4">üìù</div>
              <h3 class="text-lg font-medium text-gray-900 mb-2">–®–∞–±–ª–æ–Ω –ø—É—Å—Ç</h3>
              <p class="text-gray-500 mb-4">
                –≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –µ—â–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
              </p>
              <%= link_to edit_template_path(@template),
                  class: "inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700" do %>
                ‚úèÔ∏è –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
      
      <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ) -->
      <% if Rails.env.development? %>
        <div class="mt-4 bg-gray-100 rounded-lg p-4">
          <h4 class="text-sm font-medium text-gray-900 mb-2">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>
          <div class="text-xs text-gray-600">
            <p><strong>HTML –ø–æ–ª–µ:</strong> <%= @template.html.present? ? "–ó–∞–ø–æ–ª–Ω–µ–Ω–æ (#{@template.html.length} —Å–∏–º–≤–æ–ª–æ–≤)" : "–ü—É—Å—Ç–æ" %></p>
            <p><strong>CSS –ø–æ–ª–µ:</strong> <%= @template.css.present? ? "–ó–∞–ø–æ–ª–Ω–µ–Ω–æ (#{@template.css.length} —Å–∏–º–≤–æ–ª–æ–≤)" : "–ü—É—Å—Ç–æ" %></p>
            <p><strong>JSON –ø–æ–ª–µ:</strong> <%= @template.data.present? ? "–ó–∞–ø–æ–ª–Ω–µ–Ω–æ (#{@template.data.length} —Å–∏–º–≤–æ–ª–æ–≤)" : "–ü—É—Å—Ç–æ" %></p>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div> 